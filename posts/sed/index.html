<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Lucas Viana's ruminations</title><meta name=keywords content><meta name=description content="What is sed? Ever wanted to edit a file without having to open it in a text editor? Or maybe you want to modify several files and don&rsquo;t want to do it manually?
With sed, you just issue a short command in the terminal and bam!, you&rsquo;ve changed the contents of a file. You can see it as CTRL+R on super steroyds. sed is capable of doing simple search and replace (regex based), delete lines, add lines or even reverse the lines of a file."><meta name=author content="Lucas Viana"><link rel=canonical href=https://lucas-viana.com/posts/sed/><link crossorigin=anonymous href=/assets/css/stylesheet.8b523f1730c922e314350296d83fd666efa16519ca136320a93df674d00b6325.css integrity="sha256-i1I/FzDJIuMUNQKW2D/WZu+hZRnKE2MgqT32dNALYyU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lucas-viana.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lucas-viana.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lucas-viana.com/favicon-32x32.png><link rel=apple-touch-icon href=https://lucas-viana.com/apple-touch-icon.png><link rel=mask-icon href=https://lucas-viana.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content><meta property="og:description" content="What is sed? Ever wanted to edit a file without having to open it in a text editor? Or maybe you want to modify several files and don&rsquo;t want to do it manually?
With sed, you just issue a short command in the terminal and bam!, you&rsquo;ve changed the contents of a file. You can see it as CTRL+R on super steroyds. sed is capable of doing simple search and replace (regex based), delete lines, add lines or even reverse the lines of a file."><meta property="og:type" content="article"><meta property="og:url" content="https://lucas-viana.com/posts/sed/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="What is sed? Ever wanted to edit a file without having to open it in a text editor? Or maybe you want to modify several files and don&rsquo;t want to do it manually?
With sed, you just issue a short command in the terminal and bam!, you&rsquo;ve changed the contents of a file. You can see it as CTRL+R on super steroyds. sed is capable of doing simple search and replace (regex based), delete lines, add lines or even reverse the lines of a file."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://lucas-viana.com/posts/"},{"@type":"ListItem","position":3,"name":"","item":"https://lucas-viana.com/posts/sed/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"What is sed? Ever wanted to edit a file without having to open it in a text editor? Or maybe you want to modify several files and don\u0026rsquo;t want to do it manually?\nWith sed, you just issue a short command in the terminal and bam!, you\u0026rsquo;ve changed the contents of a file. You can see it as CTRL+R on super steroyds. sed is capable of doing simple search and replace (regex based), delete lines, add lines or even reverse the lines of a file.","keywords":[],"articleBody":"What is sed? Ever wanted to edit a file without having to open it in a text editor? Or maybe you want to modify several files and don’t want to do it manually?\nWith sed, you just issue a short command in the terminal and bam!, you’ve changed the contents of a file. You can see it as CTRL+R on super steroyds. sed is capable of doing simple search and replace (regex based), delete lines, add lines or even reverse the lines of a file.\nI’ve been using the word “file” here, and that includes stdin.\nThe simples usage Those that have used sed before might be familiar with this command, which is a regex based text replacement. It replaces “hello” by “world”:\n$ echo 'hello world' | sed 's/hello/world/' world world Or clearing all lines that start with a # (in a horrendous way!):\n$ cat input.txt | sed 's/^#.*//' We should not get satisfied with this! sed can do so much more. Only knowing how to “search-and-replace” with sed is like owning a Ferrari but never taking it to the racetrack.\nSo let’s take a step back and look at the anatomy of a sed expression. It will be dense reading, but bear with me, it will be totally worth it.\nExpressions sed expressions take the following form:\n[address]command[options] address: An optional filter which lines to apply the command to. command: a mandatory single letter to specify what to do to the selected lines. options: Optional. Each command has its own options, which can look quite different. Looking back at our initial example:\n` s/hello/world/g` ^^\\____________/ || ^ || | || +- Options of command `s` |+- Signle letter command `s` that means substitute +- Address: No address given, fine, it's optional Here we can see that the s/hello/world expression ommits the address, uses the s command with /hello/world as options.\nWhat the heck is an address though?\nAddress The address itself has its own general syntax:\naddr1[,addr2][!] Where addr can be either a line number or a regular expression, and the optional ! (bang) reverses the meaning ;)\nExamples using line numbers:\naddress meaning 1 Matches only line number 1 54 Matches only line number 54 1,5 Matches lines from 1 to 5 (included) 1,5! Match all lines that are not from 1 to 5 Examples using regular expressions:\naddress meaning /abc/ Matches lines containing “abc”. \\ra*r Matches lines containing “abc”. Instead of marking the regular expression with // it uses \\rr, where r can be any character. /abc/! Matches lines that do not contain “abc”. Mixed examples:\naddress meaning /abc/,2 Matches a line containing “abc” and the next 2 lines 2,/abc/ Matches the second line until a line containing “abc” Pimp up the s command with addresses Now you should know what this will do:\nsed '2,4s/hello/world' Yep, it will substitute “hello” by “world” from lines 2 to 4. You can go bananas combining the addresses, with the s command.\nTip: use the ! for extra points with your peers – this is barely documented. I don’t know why the man pages don’t make it clearly. Ugh!\nCommand There are quite a lot of commands to familiarize yourself with. All of them are a single character, sometimes followed by a \\\\. Here are some useful commands to try out:\ns s/regex/replacement/flags This is the most useful and most known sed command. It is also the one with the most options.\nYou can refer to the sed manual for detailed explanations on all flags. Here I will mention some useful tips for the s command:\n1. Use groups and references s/\\(hello \\)\\(world \\)/\\2\\1/ | | | | | | | +-\u003e \\1: reference to group 1 | | +---\u003e \\2: referebce to group 2 | +------------\u003e \\(world\\): group 2 +---------------------\u003e \\(hello\\): group 1 This example swaps around the words “hello” and “world”\nGroups are created by surrounding parts of your regular expression with escaped parenthesis \\( \\). Then in the replacement you can refer to a group using \\1 syntax.\n2. g: Apply to all occurences in each line More often than not, this is what you want. So your expression will usually looke like this:\ns/search/replace/g 3. i: Case insensitive d 1,5d Delete lines that were matched by the address. See how addresses can be super useful?\np sed -n '1,5p' Only print lines from 1 to 5. The -n flag tells sed to not print anything by default.\nn Fast-forward one line. You’ll understand that in the next chapter\nn;n;s/a/b/ This command fast replaces “a” by “b” every third line.\nInternal workings of sed Understanding what sed does under the hood will take your seditious work to the next level!\nFirst, accept this fact: sed has 2 buffers:\npattern space hold space Those are simply “variables” that hold some information.\nAlso accept that sed runs in cycles. Each cycle does this:\nRead line from the input stream. A line is a sequence of characters ended by a newline \\n. Remove the trailing newline. Store the line in the pattern space. Check if the line matches the address. If matched, run the commands. The commands may change the contents of the pattern and the hold spaces. Print out the content of the pattern space. Delete content of pattern space, but keep the hold space untouched. Repeat. g and h options Say we have a simple imput and want to shuffle the lines as follows:\ninput result ---------------------- line 1 line 2 line 2 line 3 line 3 ----\u003e line 4 line 4 line 1 line 5 line 5 We want to cut out line 1 and paste it after line 4. Easy.\ncat input.txt \u003e sed '1h;1d;4p;4g' Internally, sed will perform the following operations:\ncycle (line) | command | pattern | hold | output ----------------|-------------------|----------|----------|--------- 1 | read one line | line 1 | | 1 | 1h | line 1 | line 1 | 1 | 1d (end cycle) | | line 1 | 1 - end | print pattern | | line 1 | 2 | read one line | line 2 | line 1 | 2 | 1h;1d;4p;4g | line 2 | line 1 | 2 - end | print pattern | line 2 | line 1 | line 2\\n 3 | read one line | line 3 | line 1 | 3 | 1h;1d;4p;4g | line 3 | line 1 | 3 - end | print pattern | line 3 | line 1 | line 3\\n 4 | read one line | line 4 | line 1 | 4 | 1h;1d | line 4 | line 1 | 4 | 4p | line 4 | line 1 | line 4\\n 4 | 4g | line 1 | line 1 | 1 - end | print pattern | line 1 | line 1 | line 1\\n 5 | read one line | line 5 | line 1 | 5 | 1h;1d;4p;4g | line 5 | line 1 | 5 - end | print pattern | line 5 | line 1 | line 5\\n In the step-by-step above we go through each line of input and each command that is executed on them. The command 1h stores the content of the first line in the hold space. In order to prevent line 1\\n from being printed, we delete it from the pattern space with 1d. This command also ignores the next commands and immediately starts a new cycle.\nWhen we reach the 4th cycle we replace the pattern space with the contents of hold space. But before doing that we print out the initial content with 4p.\nRemember: read into pattern space, operate, print out the pattern space. Simple.\n","wordCount":"1286","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Lucas Viana"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lucas-viana.com/posts/sed/"},"publisher":{"@type":"Organization","name":"Lucas Viana's ruminations","logo":{"@type":"ImageObject","url":"https://lucas-viana.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lucas-viana.com accesskey=h title="Lucas Viana's ruminations (Alt + H)">Lucas Viana's ruminations</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lucas-viana.com>Home</a>&nbsp;»&nbsp;<a href=https://lucas-viana.com/posts/>Posts</a></div><h1 class=post-title></h1><div class=post-meta>7 min&nbsp;·&nbsp;Lucas Viana&nbsp;|&nbsp;<a href=https://github.com/senhorlucas/senhorlucas.github.io/tree/main/docs/content/posts/sed.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-sed aria-label="What is sed?">What is <code>sed</code>?</a></li><li><a href=#the-simples-usage aria-label="The simples usage">The simples usage</a></li><li><a href=#expressions aria-label=Expressions>Expressions</a></li><li><a href=#address aria-label=Address>Address</a><ul><li><a href=#pimp-up-the-s-command-with-addresses aria-label="Pimp up the s command with addresses">Pimp up the <code>s</code> command with addresses</a></li></ul></li><li><a href=#command aria-label=Command>Command</a><ul><li><a href=#s aria-label=s><code>s</code></a><ul><li><a href=#1-use-groups-and-references aria-label="1. Use groups and references">1. Use groups and references</a></li><li><a href=#2-g-apply-to-all-occurences-in-each-line aria-label="2. g: Apply to all occurences in each line">2. <code>g</code>: Apply to all occurences in each line</a></li><li><a href=#3-i-case-insensitive aria-label="3. i: Case insensitive">3. <code>i</code>: Case insensitive</a></li></ul></li><li><a href=#d aria-label=d><code>d</code></a></li><li><a href=#p aria-label=p><code>p</code></a></li><li><a href=#n aria-label=n><code>n</code></a></li></ul></li><li><a href=#internals aria-label="Internal workings of sed ">Internal workings of <code>sed</code></a><ul><li><a href=#g-and-h-options aria-label="g and h options"><code>g</code> and <code>h</code> options</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=what-is-sed>What is <code>sed</code>?<a hidden class=anchor aria-hidden=true href=#what-is-sed>#</a></h2><p>Ever wanted to edit a file without having to open it in a text editor? Or maybe
you want to modify several files and don&rsquo;t want to do it manually?</p><p>With <code>sed</code>, you just issue a short command in the terminal and bam!, you&rsquo;ve
changed the contents of a file. You can see it as <code>CTRL+R</code> on super steroyds.
<code>sed</code> is capable of doing simple search and replace (regex based), delete lines,
add lines or even reverse the lines of a file.</p><p>I&rsquo;ve been using the word &ldquo;file&rdquo; here, and that includes <code>stdin</code>.</p><h2 id=the-simples-usage>The simples usage<a hidden class=anchor aria-hidden=true href=#the-simples-usage>#</a></h2><p>Those that have used <code>sed</code> before might be familiar with this command, which
is a regex based text replacement. It replaces &ldquo;hello&rdquo; by &ldquo;world&rdquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;hello world&#39;</span> | sed <span style=color:#e6db74>&#39;s/hello/world/&#39;</span>
</span></span><span style=display:flex><span>world world
</span></span></code></pre></div><p>Or clearing all lines that start with a <code>#</code> (in a horrendous way!):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat input.txt | sed <span style=color:#e6db74>&#39;s/^#.*//&#39;</span>
</span></span></code></pre></div><p>We should not get satisfied with this! <code>sed</code> can do so much more. Only knowing
how to &ldquo;search-and-replace&rdquo; with <code>sed</code> is like owning a Ferrari but never taking
it to the racetrack.</p><p>So let&rsquo;s take a step back and look at the anatomy of a <code>sed</code> expression. It will
be dense reading, but bear with me, it will be totally worth it.</p><h2 id=expressions>Expressions<a hidden class=anchor aria-hidden=true href=#expressions>#</a></h2><p><code>sed</code> expressions take the following form:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[address]command[options]
</span></span></code></pre></div><ul><li><code>address</code>: An optional filter which lines to apply the <code>command</code> to.</li><li><code>command</code>: a mandatory <em>single letter</em> to specify what to do to the selected
lines.</li><li><code>options</code>: Optional. Each command has its own options, which can look quite
different.</li></ul><p>Looking back at our initial example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>  ` s/hello/world/g`
</span></span><span style=display:flex><span>   ^^\____________/
</span></span><span style=display:flex><span>   ||      ^
</span></span><span style=display:flex><span>   ||      |
</span></span><span style=display:flex><span>   ||      +- Options of command `s`
</span></span><span style=display:flex><span>   |+- Signle letter command `s` that means substitute
</span></span><span style=display:flex><span>   +- Address: No address given, fine, it&#39;s optional
</span></span></code></pre></div><p>Here we can see that the <code>s/hello/world</code> expression ommits the <code>address</code>, uses
the <code>s</code> command with <code>/hello/world</code> as <code>options</code>.</p><p>What the heck is an <code>address</code> though?</p><h2 id=address>Address<a hidden class=anchor aria-hidden=true href=#address>#</a></h2><p>The address itself has its own general syntax:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>addr1[,addr2][!]
</span></span></code></pre></div><p>Where <code>addr</code> can be either a line number or a regular expression, and the
optional <code>!</code> (bang) reverses the meaning ;)</p><p>Examples using line numbers:</p><table><thead><tr><th>address</th><th>meaning</th></tr></thead><tbody><tr><td><code>1</code></td><td>Matches only line number 1</td></tr><tr><td><code>54</code></td><td>Matches only line number 54</td></tr><tr><td><code>1,5</code></td><td>Matches lines from 1 to 5 (included)</td></tr><tr><td><code>1,5!</code></td><td>Match all lines that are not from 1 to 5</td></tr></tbody></table><p>Examples using regular expressions:</p><table><thead><tr><th>address</th><th>meaning</th></tr></thead><tbody><tr><td><code>/abc/</code></td><td>Matches lines containing &ldquo;abc&rdquo;.</td></tr><tr><td><code>\ra*r</code></td><td>Matches lines containing &ldquo;abc&rdquo;. Instead of marking the regular expression with <code>/&lt;regex>/</code> it uses <code>\r&lt;regex>r</code>, where <code>r</code> can be any character.</td></tr><tr><td><code>/abc/!</code></td><td>Matches lines that do not contain &ldquo;abc&rdquo;.</td></tr></tbody></table><p>Mixed examples:</p><table><thead><tr><th>address</th><th>meaning</th></tr></thead><tbody><tr><td><code>/abc/,2</code></td><td>Matches a line containing &ldquo;abc&rdquo; and the next 2 lines</td></tr><tr><td><code>2,/abc/</code></td><td>Matches the second line until a line containing &ldquo;abc&rdquo;</td></tr></tbody></table><h3 id=pimp-up-the-s-command-with-addresses>Pimp up the <code>s</code> command with addresses<a hidden class=anchor aria-hidden=true href=#pimp-up-the-s-command-with-addresses>#</a></h3><p>Now you should know what this will do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sed <span style=color:#e6db74>&#39;2,4s/hello/world&#39;</span>
</span></span></code></pre></div><p>Yep, it will substitute &ldquo;hello&rdquo; by &ldquo;world&rdquo; from lines 2 to 4. You can go bananas
combining the addresses, with the <code>s</code> command.</p><p>Tip: use the <code>!</code> for extra points with your peers &ndash; this is <em>barely</em>
documented. I don&rsquo;t know why the <code>man</code> pages don&rsquo;t make it clearly. Ugh!</p><h2 id=command>Command<a hidden class=anchor aria-hidden=true href=#command>#</a></h2><p>There are quite a lot of commands to familiarize yourself with. All of them are
a single character, sometimes followed by a <code>\\</code>. Here are some useful commands
to try out:</p><h3 id=s><code>s</code><a hidden class=anchor aria-hidden=true href=#s>#</a></h3><pre><code>s/regex/replacement/flags
</code></pre><p>This is the most useful and most known <code>sed</code> command. It is also the one with
the most options.</p><p>You can refer to <a href=https://www.gnu.org/software/sed/manual/sed.html#The-_0022s_0022-Command>the <code>sed</code>
manual</a>
for detailed explanations on all flags. Here I will mention some useful tips for
the <code>s</code> command:</p><h4 id=1-use-groups-and-references>1. Use groups and references<a hidden class=anchor aria-hidden=true href=#1-use-groups-and-references>#</a></h4><pre tabindex=0><code>    s/\(hello \)\(world \)/\2\1/
          |        |        | |
          |        |        | +-&gt; \1: reference to group 1
          |        |        +---&gt; \2: referebce to group 2
          |        +------------&gt; \(world\): group 2
          +---------------------&gt; \(hello\): group 1
</code></pre><p>This example swaps around the words &ldquo;hello&rdquo; and &ldquo;world&rdquo;</p><p>Groups are created by surrounding parts of your regular expression with
escaped parenthesis <code>\( \)</code>. Then in the <code>replacement</code> you can refer to a
group using <code>\1</code> syntax.</p><h4 id=2-g-apply-to-all-occurences-in-each-line>2. <code>g</code>: Apply to all occurences in each line<a hidden class=anchor aria-hidden=true href=#2-g-apply-to-all-occurences-in-each-line>#</a></h4><p>More often than not, this is what you want. So your expression will usually
looke like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sed data-lang=sed><span style=display:flex><span><span style=color:#66d9ef>s</span>/<span style=color:#e6db74>search</span>/<span style=color:#e6db74>replace</span>/<span style=color:#66d9ef>g</span>
</span></span></code></pre></div><h4 id=3-i-case-insensitive>3. <code>i</code>: Case insensitive<a hidden class=anchor aria-hidden=true href=#3-i-case-insensitive>#</a></h4><h3 id=d><code>d</code><a hidden class=anchor aria-hidden=true href=#d>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sed data-lang=sed><span style=display:flex><span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>5</span><span style=color:#66d9ef>d</span>
</span></span></code></pre></div><p>Delete lines that were matched by the <code>address</code>. See how addresses can be super
useful?</p><h3 id=p><code>p</code><a hidden class=anchor aria-hidden=true href=#p>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -n <span style=color:#e6db74>&#39;1,5p&#39;</span>
</span></span></code></pre></div><p>Only print lines from 1 to 5. The <code>-n</code> flag tells <code>sed</code> to not print anything by
default.</p><h3 id=n><code>n</code><a hidden class=anchor aria-hidden=true href=#n>#</a></h3><p>Fast-forward one line. You&rsquo;ll understand that in the <a href=#internals>next chapter</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sed data-lang=sed><span style=display:flex><span><span style=color:#66d9ef>n</span>;<span style=color:#66d9ef>n</span>;<span style=color:#66d9ef>s</span>/<span style=color:#e6db74>a</span>/<span style=color:#e6db74>b</span>/
</span></span></code></pre></div><p>This command fast replaces &ldquo;a&rdquo; by &ldquo;b&rdquo; every third line.</p><h2 id=internals>Internal workings of <code>sed</code> <a hidden class=anchor aria-hidden=true href=#internals>#</a></h2><p>Understanding what <code>sed</code> does under the hood will take your <code>sed</code>itious work to
the next level!</p><p>First, accept this fact: <code>sed</code> has 2 buffers:</p><ul><li>pattern space</li><li>hold space</li></ul><p>Those are simply &ldquo;variables&rdquo; that hold some information.</p><p>Also accept that <code>sed</code> runs in cycles. Each cycle does this:</p><ol><li>Read line from the input stream. A line is a sequence of characters ended by
a newline <code>\n</code>.</li><li>Remove the trailing newline.</li><li>Store the line in the <em>pattern</em> space.</li><li>Check if the line matches the <code>address</code>.</li><li>If matched, run the commands. The commands may change the contents of the
<em>pattern</em> and the <em>hold</em> spaces.</li><li>Print out the content of the <em>pattern</em> space.</li><li>Delete content of <em>pattern</em> space, but keep the <em>hold</em> space untouched.</li><li>Repeat.</li></ol><h3 id=g-and-h-options><code>g</code> and <code>h</code> options<a hidden class=anchor aria-hidden=true href=#g-and-h-options>#</a></h3><p>Say we have a simple imput and want to shuffle the lines as follows:</p><pre tabindex=0><code>input           result
----------------------
line 1          line 2
line 2          line 3
line 3  ----&gt;   line 4
line 4          line 1
line 5          line 5
</code></pre><p>We want to cut out <code>line 1</code> and paste it after <code>line 4</code>. Easy.</p><pre><code>cat input.txt &gt; sed '1h;1d;4p;4g'
</code></pre><p>Internally, <code>sed</code> will perform the following operations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>cycle (line)    | command           | pattern  | hold     | output
</span></span><span style=display:flex><span>----------------|-------------------|----------|----------|---------
</span></span><span style=display:flex><span>1               | read one line     | line 1   |          |
</span></span><span style=display:flex><span>1               | 1h                | line 1   | line 1   |
</span></span><span style=display:flex><span>1               | 1d (end cycle)    |          | line 1   |
</span></span><span style=display:flex><span>1 - end         | print pattern     |          | line 1   | &lt;blank&gt;
</span></span><span style=display:flex><span>2               | read one line     | line 2   | line 1   |
</span></span><span style=display:flex><span>2               | 1h;1d;4p;4g       | line 2   | line 1   |
</span></span><span style=display:flex><span>2 - end         | print pattern     | line 2   | line 1   | line 2\n
</span></span><span style=display:flex><span>3               | read one line     | line 3   | line 1   |
</span></span><span style=display:flex><span>3               | 1h;1d;4p;4g       | line 3   | line 1   |
</span></span><span style=display:flex><span>3 - end         | print pattern     | line 3   | line 1   | line 3\n
</span></span><span style=display:flex><span>4               | read one line     | line 4   | line 1   |
</span></span><span style=display:flex><span>4               | 1h;1d             | line 4   | line 1   |
</span></span><span style=display:flex><span>4               | 4p                | line 4   | line 1   | line 4\n
</span></span><span style=display:flex><span>4               | 4g                | line 1   | line 1   |
</span></span><span style=display:flex><span>1 - end         | print pattern     | line 1   | line 1   | line 1\n
</span></span><span style=display:flex><span>5               | read one line     | line 5   | line 1   |
</span></span><span style=display:flex><span>5               | 1h;1d;4p;4g       | line 5   | line 1   |
</span></span><span style=display:flex><span>5 - end         | print pattern     | line 5   | line 1   | line 5\n
</span></span></code></pre></div><p>In the step-by-step above we go through each line of input and each command that
is executed on them. The command <code>1h</code> stores the content of the first line in the
<em>hold</em> space. In order to prevent <code>line 1\n</code> from being printed, we delete it
from the <em>pattern</em> space with <code>1d</code>. This command also ignores the next commands
and immediately starts a new cycle.</p><p>When we reach the 4th cycle we replace the <em>pattern</em> space with the contents of
<em>hold</em> space. But before doing that we print out the initial content with <code>4p</code>.</p><p>Remember: read into <em>pattern</em> space, operate, print out the <em>pattern</em> space.
Simple.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://lucas-viana.com/posts/2021-12-25-utf8/><span class=title>« Prev</span><br><span>The down and dirty of UTF-8</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share  on twitter" href="https://twitter.com/intent/tweet/?text=&url=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share  on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f&title=&summary=&source=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share  on reddit" href="https://reddit.com/submit?url=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f&title="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share  on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share  on whatsapp" href="https://api.whatsapp.com/send?text=%20-%20https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share  on telegram" href="https://telegram.me/share/url?text=&url=https%3a%2f%2flucas-viana.com%2fposts%2fsed%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://lucas-viana.com>Lucas Viana's ruminations</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>